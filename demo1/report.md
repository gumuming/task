# <center> 傲风项目交接方报告
## 一、核心业务
 
### 1 用户模块

#### 业务部分
```
---傲风游戏后台中的渠道管理 添加渠道中的账号密码是渠道管理系统的登陆凭证。
---管理员用户是由超级管理员添加
```
#### 技术部分：
```
---登陆验证逻辑主要是生成uuid任务sessionId进行登陆校验和接口权限校验。sessionId保存在mongo数据库中。
---uuid 是随机生成的，同一账号密码在多个终端可以同时登陆
```
### 2 权限模块
#### 业务部分
```
 ---基于角色-权限-资源模型建立的权限，没有数据权限业务
```
#### 技术部分：
```
 ---常规web应用权限模块
 ```
### 3 订单模块
#### 业务部分
```
 --- 订单模块主要是根据游戏发起订单(充值，购买礼包等)，生成记录。主要包括退款记录，交易流水，支付成功调用游戏厂商接口发货。并生成通知记录。
 --- 订单分为厂商订单、专服订单、渠道订单、混服订单
 --- 专服: 混服cps：混服联运：运营模式
 ---订单提现是申请-审核-提现流程，线下打款。分三级审核
 ---渠道风控 核心是部分订单金额延迟打款
```
#### 技术部分：
```
 ---数据表
  主要是平台订单表，生成平台订单，支付成功后，通知相应厂商并生成厂商订单表，通过平台订单号关联，同时记录相应通知信息到通知表。辅助有交易流水表、订单退款表、订单转移表。
 --- 代码
 1 订单生成采用redis分布式锁方式保证并发数据完整性，同时对订单表增加了分区功能，目前分区语句到2023年1月。
 2 订单业务处理： 订单根据订单类型、是否折扣、是否返利来计算订单金额（具体在原型上说明）
 3 订单充值成功通知厂商，通过rabbitmq延迟队列方式和与游戏厂商商定的通知api接口规划完成。通知时间是硬编码，没有配置
 
```
### 4 打包模块
#### 业务部分
```
--- 根据厂商提供的sdk进行打包封装，主要是增加渠道信息等业务信息。有母包概念。打包分等级进行打包，等级越高，优先打包
```

#### 技术部分：
```
--- 游戏下载链接有原始链接和短链接之分，通过nginx 匹配指定/d 格式请求转发到特定接口。数据持久到mysql（aff_surl_define）通短链接参数查询原始链接
--- 游戏打包区分ios和andriod.傲风游戏管理添加打包任务后，发送消息到mq，mq消费端监听到消息，根据消息内容拼接打包相应渠道游戏参数，执行python脚本，根据python脚本执行情况并更改数据库打包任务状态。
--- 游戏打包分等级，等级通过设置mq消息优先级来标识。
```
### 5 sdk模块
#### 业务部分
```
 --- sdk 主要是与游戏厂商商定玩家订单充值通知厂商发货机制，辅助有获取平台token，标识是否是外部接口，获取玩家用户信息等接口
```

#### 技术部分：
```
详见sdk 对接文档
```
### 6 渠道模块
#### 业务部分 
```
---傲风平台：渠道主要是标识游戏玩家是通过那种方式接入傲风平台。渠道具有层次关系。每个渠道有相应的属性：账号 密码 折扣点 登陆/注册限制
---渠道管理平台：是傲风渠道的拓展。是当前主渠道或其子渠道的相关业务和数据操作平台。主要是修改当前渠道账号的信息、当前渠道下的业绩、玩家、订单、消息的管理
```
### 技术部分：
```
常规CRUD操作
```
### 7 数据配置项
#### 业务部分
```
--- 主要是系统中的配置，部分功能菜单配置
```
#### 技术部分：
```
--- aff_system_cmd 框架配置调用表
--- aff_system_param 
```

### 8 放端管理
#### 业务部分
```

```
#### 技术部分：
```
常规CRUD操作
```
### 9 游戏对接
#### 业务部分
```
主要是游戏厂商根据sdk对接文档录入平台相应的游戏Id 回调地址
```
#### 技术部分：
```
常规CRUD操作
```
### 10 其它
```
主要涉及其它模块、厂商管理、扶持中心、玩家管理、福利中心、微信中心、通知管理等。
```
```
业务较简单、常规CRUD操作
```



## 二、 项目架构
```
见图
```

## 三、服务器部署
```
见图
```